(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{"+2Nz":function(e,t,r){"use strict";r.r(t);var a=r("mrSG"),n=r("LvDl"),s=r.n(n),o=r("Obii"),i=r("eqT+"),c=r("ceQ3"),u={comment:{pattern:/(^|[^\n])#.*/,lookbehind:!0},"context-labels":{pattern:/(^|\s)\{[^}]*(?=})/,lookbehind:!0,inside:{"label-key":{pattern:/[a-z_]\w*(?=\s*(=|!=|=~|!~))/,alias:"attr-name"},"label-value":{pattern:/"(?:\\.|[^\\"])*"/,greedy:!0,alias:"attr-value"},punctuation:/[{]/}},operator:new RegExp("/&&?|\\|?\\||!=?|<(?:=>?|<|>)?|>[>=]?","i"),punctuation:/[{}`,.]/},l=r("sBLX"),p=["job","namespace"],d=864e5,f=function(e){return{label:e}},h=function(e){return{start:1e6*e.from,end:1e6*e.to}};var b=function(e){function t(t,r){var a=e.call(this)||this;return a.cleanText=function(e){return e.replace(/[{}[\]="(),!~+\-*\/^%]/g,"").trim()},a.request=function(e,t){return a.datasource.metadataRequest(e,t)},a.start=function(){return a.startTask||(a.startTask=a.fetchLogLabels(a.initialRange).then(function(){return a.started=!0,[]})),a.startTask},a.datasource=t,a.labelKeys={},a.labelValues={},Object.assign(a,r),a}return Object(a.c)(t,e),t.prototype.getSyntax=function(){return u},t.prototype.getLabelKeys=function(){return this.labelKeys["{}"]},t.prototype.getLabelValues=function(e){return Object(a.b)(this,void 0,Promise,function(){return Object(a.d)(this,function(t){switch(t.label){case 0:return[4,this.fetchLabelValues(e,this.initialRange)];case 1:return t.sent(),[2,this.labelValues["{}"][e]]}})})},t.prototype.provideCompletionItems=function(e,t){return Object(a.b)(this,void 0,Promise,function(){var r,n,o;return Object(a.d)(this,function(a){switch(a.label){case 0:return r=e.wrapperClasses,n=e.value,o=0===n.document.text.length,s.a.includes(r,"context-labels")?[4,this.getLabelCompletionItems(e,t)]:[3,2];case 1:return[2,a.sent()];case 2:if(o)return[2,this.getEmptyCompletionItems(t||{})];a.label=3;case 3:return[2,{suggestions:[]}]}})})},t.prototype.getEmptyCompletionItems=function(e){var t=e.history,r=[];if(t&&t.length>0){var n=s.a.chain(t).map(function(e){return e.query.expr}).filter().uniq().take(10).map(f).map(function(e){return function(e,t){var r=Date.now()-d,n=t.filter(function(t){return t.ts>r&&t.query.expr===e.label}),s=n.length,i=n[0],c="Queried "+s+" times in the last 24h.";return i&&(c=c+" Last queried "+Object(o.dateTime)(i.ts).fromNow()+"."),Object(a.a)(Object(a.a)({},e),{documentation:c})}(e,t)}).value();r.push({prefixMatch:!0,skipSort:!0,label:"History",items:n})}return{suggestions:r}},t.prototype.getLabelCompletionItems=function(e,t){var r=e.text,n=e.wrapperClasses,o=e.labelKey,i=e.value,u=t.absoluteRange;return Object(a.b)(this,void 0,Promise,function(){var e,t,l,d,h,b,m,v,y,g;return Object(a.d)(this,function(a){switch(a.label){case 0:t=[],l=i.anchorBlock.getText(),d=i.selection.anchor.offset,h="{}";try{b=Object(c.c)(l,d)}catch(e){}return m=b?b.labelKeys:[],r&&r.match(/^!?=~?/)||n.includes("attr-value")?o&&this.labelValues[h]?(v=this.labelValues[h][o])?[3,2]:[4,this.fetchLabelValues(o,u)]:[3,3]:[3,4];case 1:a.sent(),v=this.labelValues[h][o],a.label=2;case 2:e="context-label-values",t.push({label:'Label values for "'+o+'"',items:v.map(f)}),a.label=3;case 3:return[3,5];case 4:(y=this.labelKeys[h]||p)&&(g=s.a.difference(y,m)).length>0&&(e="context-labels",t.push({label:"Labels",items:g.map(f)})),a.label=5;case 5:return[2,{context:e,suggestions:t}]}})})},t.prototype.importQueries=function(e,t){return Object(a.b)(this,void 0,Promise,function(){var r=this;return Object(a.d)(this,function(n){return"prometheus"===t?[2,Promise.all(e.map(function(e){return Object(a.b)(r,void 0,void 0,function(){var t,r,n;return Object(a.d)(this,function(s){switch(s.label){case 0:return[4,this.importPrometheusQuery(e.expr)];case 1:return t=s.sent(),(r=e).context,n=Object(a.g)(r,["context"]),[2,Object(a.a)(Object(a.a)({},n),{expr:t})]}})})}))]:[2,e.map(function(e){return{refId:e.refId,expr:""}})]})})},t.prototype.importPrometheusQuery=function(e){return Object(a.b)(this,void 0,Promise,function(){var t,r,n,s,o,i,u;return Object(a.d)(this,function(a){switch(a.label){case 0:return e?(t=e.match(c.f))?(r=t[0],n={},r.replace(c.b,function(e,t,r,a){return n[t]={value:a,operator:r},""}),[4,this.start()]):[3,2]:[2,""];case 1:if(a.sent(),s=this.labelKeys["{}"],o={},s&&s.length>0)for(i in n)s&&s.includes(i)&&(o[i]=n[i]);else o=n;return u=Object.keys(o).sort(),[2,["{",u.map(function(e){return""+e+o[e].operator+o[e].value}).join(","),"}"].join("")];case 2:return[2,""]}})})},t.prototype.fetchLogLabels=function(e){return Object(a.b)(this,void 0,Promise,function(){var t,r,n,s,o,i,c;return Object(a.d)(this,function(u){switch(u.label){case 0:t="/api/prom/label",u.label=1;case 1:return u.trys.push([1,4,,5]),this.logLabelFetchTs=Date.now(),[4,this.request(t,h(e))];case 2:return[4,(r=u.sent()).data||r.json()];case 3:return n=u.sent(),s=n.data.slice().sort(),this.labelKeys=Object(a.a)(Object(a.a)({},this.labelKeys),((i={})["{}"]=s,i)),this.labelValues=((c={})["{}"]={},c),this.logLabelOptions=s.map(function(e){return{label:e,value:e,isLeaf:!1}}),[3,5];case 4:return o=u.sent(),console.error(o),[3,5];case 5:return[2,[]]}})})},t.prototype.refreshLogLabels=function(e,t){return Object(a.b)(this,void 0,void 0,function(){return Object(a.d)(this,function(r){switch(r.label){case 0:return this.labelKeys&&Date.now()-this.logLabelFetchTs>3e4||t?[4,this.fetchLogLabels(e)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.fetchLabelValues=function(e,t){return Object(a.b)(this,void 0,void 0,function(){var r,n,s,o,i,c,u,l,p;return Object(a.d)(this,function(d){switch(d.label){case 0:r="/api/prom/label/"+e+"/values",d.label=1;case 1:return d.trys.push([1,4,,5]),[4,this.request(r,h(t))];case 2:return[4,(n=d.sent()).data||n.json()];case 3:return s=d.sent(),o=s.data.slice().sort(),this.logLabelOptions=this.logLabelOptions.map(function(t){return t.value===e?Object(a.a)(Object(a.a)({},t),{children:o.map(function(e){return{label:e,value:e}})}):t}),i=this.labelValues["{}"],c=Object(a.a)(Object(a.a)({},i),((l={})[e]=o,l)),this.labelValues=Object(a.a)(Object(a.a)({},this.labelValues),((p={})["{}"]=c,p)),[3,5];case 4:return u=d.sent(),console.error(u),[3,5];case 5:return[2]}})})},t}(l.d);function m(e,t,r){var n,s,i=e.parsedLabels;!i&&e.labels&&(i=Object(o.parseLabels)(e.labels));var c=new o.ArrayVector([]),u=new o.ArrayVector([]),l=new o.ArrayVector([]);try{for(var p=Object(a.i)(e.entries),d=p.next();!d.done;d=p.next()){var f=d.value,h=f.ts||f.timestamp;c.add(h),u.add(f.line),l.add(h+"_"+e.labels)}}catch(e){n={error:e}}finally{try{d&&!d.done&&(s=p.return)&&s.call(p)}finally{if(n)throw n.error}}return t&&(c.buffer=c.buffer.reverse(),u.buffer=u.buffer.reverse()),{refId:r,labels:i,fields:[{name:"ts",type:o.FieldType.time,config:{title:"Time"},values:c},{name:"line",type:o.FieldType.string,config:{},values:u},{name:"id",type:o.FieldType.string,config:{},values:l}],length:c.length}}var v=/(?:^|\s){[^{]*}/g,y="(?i)";function g(e){var t=(e=e||"").match(v),r=e,a="";return t&&((a=e.replace(v,"").trim())&&-1===a.search(/\|=|\|~|!=|!~/)?(r=t[0].trim(),a.startsWith(y)||(a=""+y+a)):a=""),{regexp:a,query:r}}function _(e,t){return((e||"")+" "+(t||"")).trim()}function x(e){var t=g(e);if(t.regexp)return[t.regexp];for(var r=e,a=[];r;){var n=r.search(/\|=|\|~|!=|!~/);if(-1===n)break;var s=0===r.substr(n).search(/!=|!~/);if(r=r.substr(n+2),!s){var o=r.search(/\|=|\|~|!=|!~/),i=void 0;-1===o?i=r.trim():(i=r.substr(0,o).trim(),r=r.substr(o));var c=i.match(/^"((?:[^\\"]|\\")*)"$/);if(!c)return null;var u=c[1];a.push(u)}}return a}var O=r("kDLi"),j=r("m257"),w=r("K9Ia"),L=r("FFOo"),k=r("6blF"),S=r("pugT"),E=r("S5bw"),q={url:"",deserializer:function(e){return JSON.parse(e.data)},serializer:function(e){return JSON.stringify(e)}},T=function(e){function t(t,r){var n=e.call(this)||this;if(t instanceof k.a)n.destination=r,n.source=t;else{var s=n._config=a.a({},q);if(n._output=new w.b,"string"==typeof t)s.url=t;else for(var o in t)t.hasOwnProperty(o)&&(s[o]=t[o]);if(!s.WebSocketCtor&&WebSocket)s.WebSocketCtor=WebSocket;else if(!s.WebSocketCtor)throw new Error("no WebSocket constructor can be found");n.destination=new E.a}return n}return a.c(t,e),t.prototype.lift=function(e){var r=new t(this._config,this.destination);return r.operator=e,r.source=this,r},t.prototype._resetState=function(){this._socket=null,this.source||(this.destination=new E.a),this._output=new w.b},t.prototype.multiplex=function(e,t,r){var a=this;return new k.a(function(n){try{a.next(e())}catch(e){n.error(e)}var s=a.subscribe(function(e){try{r(e)&&n.next(e)}catch(e){n.error(e)}},function(e){return n.error(e)},function(){return n.complete()});return function(){try{a.next(t())}catch(e){n.error(e)}s.unsubscribe()}})},t.prototype._connectSocket=function(){var e=this,t=this._config,r=t.WebSocketCtor,a=t.protocol,n=t.url,s=t.binaryType,o=this._output,i=null;try{i=a?new r(n,a):new r(n),this._socket=i,s&&(this._socket.binaryType=s)}catch(e){return void o.error(e)}var c=new S.a(function(){e._socket=null,i&&1===i.readyState&&i.close()});i.onopen=function(t){if(!e._socket)return i.close(),void e._resetState();var r=e._config.openObserver;r&&r.next(t);var a=e.destination;e.destination=L.a.create(function(t){if(1===i.readyState)try{var r=e._config.serializer;i.send(r(t))}catch(t){e.destination.error(t)}},function(t){var r=e._config.closingObserver;r&&r.next(void 0),t&&t.code?i.close(t.code,t.reason):o.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }")),e._resetState()},function(){var t=e._config.closingObserver;t&&t.next(void 0),i.close(),e._resetState()}),a&&a instanceof E.a&&c.add(a.subscribe(e.destination))},i.onerror=function(t){e._resetState(),o.error(t)},i.onclose=function(t){e._resetState();var r=e._config.closeObserver;r&&r.next(t),t.wasClean?o.complete():o.error(t)},i.onmessage=function(t){try{var r=e._config.deserializer;o.next(r(t))}catch(e){o.error(e)}}},t.prototype._subscribe=function(e){var t=this,r=this.source;return r?r.subscribe(e):(this._socket||this._connectSocket(),this._output.subscribe(e),e.add(function(){var e=t._socket;0===t._output.observers.length&&(e&&1===e.readyState&&e.close(),t._resetState())}),e)},t.prototype.unsubscribe=function(){var t=this._socket;t&&1===t.readyState&&t.close(),this._resetState(),e.prototype.unsubscribe.call(this)},t}(w.a);var C=r("2WpN"),R=r("67Y/"),I=function(){function e(){this.streams={}}return e.prototype.getStream=function(e){var t,r=this,n=this.streams[e.url];if(!n){var s=new o.CircularDataFrame({capacity:e.size});s.labels=Object(o.parseLabels)(e.query),s.addField({name:"ts",type:o.FieldType.time,config:{title:"Time"}}),s.addField({name:"line",type:o.FieldType.string}),s.addField({name:"labels",type:o.FieldType.other}),s.addField({name:"id",type:o.FieldType.string}),n=(t=e.url,new T(t)).pipe(Object(C.a)(function(){delete r.streams[e.url]}),Object(R.a)(function(e){return function(e,t){var r,n,s,i,c=e.streams;if(c&&c.length)try{for(var u=Object(a.i)(c),l=u.next();!l.done;l=u.next()){var p=l.value,d=Object(o.parseLabels)(p.labels),f=Object(o.findUniqueLabels)(d,t.labels||{});try{for(var h=(s=void 0,Object(a.i)(p.entries)),b=h.next();!b.done;b=h.next()){var m=b.value,v=m.ts||m.timestamp;t.values.ts.add(v),t.values.line.add(m.line),t.values.labels.add(f),t.values.id.add(v+"_"+p.labels)}}catch(e){s={error:e}}finally{try{b&&!b.done&&(i=h.return)&&i.call(h)}finally{if(s)throw s.error}}}}catch(e){r={error:e}}finally{try{l&&!l.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}}(e,s),[s]})),this.streams[e.url]=n}return n},e}(),D=r("0/uQ"),Q=r("p0ib"),P=r("VnD/"),F=1e3,A={direction:"BACKWARD",limit:F,regexp:"",query:""};function N(e){return Object.keys(e).map(function(t){var r=e[t];return encodeURIComponent(t)+"="+encodeURIComponent(r)}).join("&")}var V=function(e){function t(t,r,n){var s=e.call(this,t)||this;s.instanceSettings=t,s.backendSrv=r,s.templateSrv=n,s.streams=new I,s.processError=function(e,t){var r={message:"Unknown error during query transaction. Please check JS console logs.",refId:t.refId};return e.data?"string"==typeof e.data?r.message=e.data:e.data.error&&(r.message=Object(j.t)(e.data.error)):e.message?r.message=e.message:"string"==typeof e&&(r.message=e),r.status=e.status,r.statusText=e.statusText,r},s.processResult=function(e,t){var r,n,o=[];if(0===Object.keys(e).length)return o;if(!e.streams)return[m(e,!1,t.refId)];e=e;try{for(var i=Object(a.i)(e.streams||[]),c=i.next();!c.done;c=i.next()){var u=m(c.value);u.refId=t.refId,u.meta={searchWords:x(_(t.query,t.regexp)),limit:s.maxLines},o.push(u)}}catch(e){r={error:e}}finally{try{c&&!c.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return o},s.runLiveQuery=function(e,t){var r=s.prepareLiveTarget(t,e);return s.streams.getStream(r).pipe(Object(R.a)(function(e){return{data:e,key:"loki-"+r.refId,state:o.LoadingState.Streaming}}))},s.runQuery=function(e,t){var r=s.prepareQueryTarget(t,e);return Object(D.a)(s._request("/api/prom/query",r).catch(function(e){if(e.cancelled)return e;throw s.processError(e,r)})).pipe(Object(P.a)(function(e){return!e.cancelled}),Object(R.a)(function(e){return{data:s.processResult(e.data,r),key:r.refId}}))},s.prepareLogRowContextQueryTarget=function(e,t,r){var n=Object.keys(e.labels).map(function(t){return t+'="'+e.labels[t]+'"'}).join(","),s=1e6*e.timeEpochMs,o={limit:t,query:"{"+n+"}",direction:r};return"BACKWARD"===r?Object(a.a)(Object(a.a)({},o),{start:s-72e11,end:e.timestamp,direction:r}):Object(a.a)(Object(a.a)({},o),{start:e.timestamp,end:s+72e11})},s.getLogRowContext=function(e,t){return Object(a.b)(s,void 0,void 0,function(){var r,n,s,o,i,c,u,l,p,d;return Object(a.d)(this,function(f){switch(f.label){case 0:r=this.prepareLogRowContextQueryTarget(e,t&&t.limit||10,t&&t.direction||"BACKWARD"),n=[],f.label=1;case 1:return f.trys.push([1,3,,4]),s=t&&"FORWARD"===t.direction,[4,this._request("/api/prom/query",r)];case 2:if((o=f.sent()).data)try{for(i=Object(a.i)(o.data.streams||[]),c=i.next();!c.done;c=i.next())u=c.value,n.push(m(u,s))}catch(e){p={error:e}}finally{try{c&&!c.done&&(d=i.return)&&d.call(i)}finally{if(p)throw p.error}}return[2,{data:n}];case 3:throw l=f.sent(),{message:"Error during context query. Please check JS console logs.",status:l.status,statusText:l.statusText};case 4:return[2]}})})},s.languageProvider=new b(s);var i=t.jsonData||{};return s.maxLines=parseInt(i.maxLines,10)||F,s}return t.$inject=["instanceSettings","backendSrv","templateSrv"],Object(a.c)(t,e),t.prototype._request=function(e,t,r){var n=""+this.instanceSettings.url+e+"?"+(t?N(t):""),s=Object(a.a)(Object(a.a)({},r),{url:n});return this.backendSrv.datasourceRequest(s)},t.prototype.prepareLiveTarget=function(e,t){var r=g(this.templateSrv.replace(e.expr)),a=r.query,n=r.regexp,s=e.refId,o=this.instanceSettings.url,i=N({query:a,regexp:n});return{query:a,regexp:n,url:Object(j.f)(o+"/api/prom/tail?"+i),refId:s,size:Math.min(t.maxDataPoints||1/0,this.maxLines)}},t.prototype.prepareQueryTarget=function(e,t){var r=g(this.templateSrv.replace(e.expr)),n=r.query,s=r.regexp,o=this.getTime(t.range.from,!1),i=this.getTime(t.range.to,!0),c=e.refId;return Object(a.a)(Object(a.a)({},A),{query:n,regexp:s,start:o,end:i,limit:Math.min(t.maxDataPoints||1/0,this.maxLines),refId:c})},t.prototype.query=function(e){var t=this,r=e.targets.filter(function(e){return e.expr&&!e.hide}).map(function(r){return r.liveStreaming?t.runLiveQuery(e,r):t.runQuery(e,r)});return Q.a.apply(void 0,Object(a.h)(r))},t.prototype.interpolateVariablesInQueries=function(e){var t=this,r=e;return e&&e.length>0&&(r=e.map(function(e){return Object(a.a)(Object(a.a)({},e),{datasource:t.name,expr:t.templateSrv.replace(e.expr)})})),r},t.prototype.importQueries=function(e,t){return Object(a.b)(this,void 0,Promise,function(){return Object(a.d)(this,function(r){return[2,this.languageProvider.importQueries(e,t.id)]})})},t.prototype.metadataRequest=function(e,t){var r=e.replace("v1","prom");return this._request(r,t,{silent:!0}).then(function(e){return{data:{data:e.data.values||[]}}})},t.prototype.modifyQuery=function(e,t){var r=g(e.expr||""),n=r.query;switch(t.type){case"ADD_FILTER":n=Object(i.a)(n,t.key,t.value)}var s=_(n,r.regexp);return Object(a.a)(Object(a.a)({},e),{expr:s})},t.prototype.getHighlighterExpression=function(e){return x(e.expr)},t.prototype.getTime=function(e,t){return s.a.isString(e)&&(e=o.dateMath.parse(e,t)),Math.ceil(1e6*e.valueOf())},t.prototype.testDatasource=function(){var e=Date.now()-6e5+"000000";return this._request("/api/prom/label",{start:e}).then(function(e){return e&&e.data&&e.data.values&&e.data.values.length>0?{status:"success",message:"Data source connected and labels found."}:{status:"error",message:"Data source connected, but no labels received. Verify that Loki and Promtail is configured properly."}}).catch(function(e){var t="Loki: ";return e.statusText?t+=e.statusText:t+="Cannot connect to Loki",e.status&&(t+=". "+e.status),e.data&&e.data.message?t+=". "+e.data.message:e.data&&(t+=". "+e.data),{status:"error",message:t}})},t.prototype.annotationQuery=function(e){return Object(a.b)(this,void 0,Promise,function(){var t,r,n,s,i,c,u,l,p;return Object(a.d)(this,function(d){switch(d.label){case 0:return e.annotation.expr?(t=function(e){var t="annotation-"+e.annotation.name,r={refId:t,expr:e.annotation.expr};return{requestId:t,range:e.range,targets:[r],dashboardId:e.dashboard.id,scopedVars:null,startTime:Date.now(),maxDataPoints:0,timezone:"utc",panelId:0,interval:"",intervalMs:0}}(e),[4,this.runQuery(t,t.targets[0]).toPromise()]):[2,[]];case 1:r=d.sent().data,n=[],s=function(e){var t=Object.values(e.labels);new o.DataFrameView(e).forEachRow(function(e){n.push({time:new Date(e.ts).valueOf(),text:e.line,tags:t})})};try{for(i=Object(a.i)(r),c=i.next();!c.done;c=i.next())u=c.value,s(u)}catch(e){l={error:e}}finally{try{c&&!c.done&&(p=i.return)&&p.call(i)}finally{if(l)throw l.error}}return[2,n]}})})},t}(O.DataSourceApi),K=r("q1tI"),W=r.n(K),z=['{job="default/prometheus"}'],U=["job","app","k8s_app"],M=5,B=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={userExamples:z},t.checkUserLabels=function(){return Object(a.b)(t,void 0,void 0,function(){var e,t,r,s,o;return Object(a.d)(this,function(a){switch(a.label){case 0:return(e=this.props.datasource.languageProvider).started?(t=e.getLabelKeys()||[],(r=U.find(function(e){return t.includes(e)}))?[4,e.getLabelValues(r)]:[3,2]):[3,3];case 1:s=a.sent(),o=Object(n.shuffle)(s).slice(0,M).map(function(e){return"{"+r+'="'+e+'"}'}),this.setState({userExamples:o}),a.label=2;case 2:return[3,4];case 3:this.scheduleUserLabelChecking(),a.label=4;case 4:return[2]}})})},t}return Object(a.c)(t,e),t.prototype.componentDidMount=function(){this.scheduleUserLabelChecking()},t.prototype.componentWillUnmount=function(){clearTimeout(this.userLabelTimer)},t.prototype.scheduleUserLabelChecking=function(){this.userLabelTimer=setTimeout(this.checkUserLabels,1e3)},t.prototype.renderExpression=function(e){var t=this.props.onClickExample;return W.a.createElement("div",{className:"cheat-sheet-item__example",key:e,onClick:function(r){return t({refId:"A",expr:e})}},W.a.createElement("code",null,e))},t.prototype.render=function(){var e=this,t=this.state.userExamples;return W.a.createElement(W.a.Fragment,null,W.a.createElement("h2",null,"Loki Cheat Sheet"),W.a.createElement("div",{className:"cheat-sheet-item"},W.a.createElement("div",{className:"cheat-sheet-item__title"},"See your logs"),W.a.createElement("div",{className:"cheat-sheet-item__label"},"Start by selecting a log stream from the Log labels selector."),W.a.createElement("div",{className:"cheat-sheet-item__label"},"Alternatively, you can write a stream selector into the query field:"),this.renderExpression('{job="default/prometheus"}'),t!==z&&t.length>0?W.a.createElement("div",null,W.a.createElement("div",{className:"cheat-sheet-item__label"},"Here are some example streams from your logs:"),t.map(function(t){return e.renderExpression(t)})):null),W.a.createElement("div",{className:"cheat-sheet-item"},W.a.createElement("div",{className:"cheat-sheet-item__title"},"Combine stream selectors"),this.renderExpression('{app="cassandra",namespace="prod"}'),W.a.createElement("div",{className:"cheat-sheet-item__label"},"Returns all log lines from streams that have both labels.")),W.a.createElement("div",{className:"cheat-sheet-item"},W.a.createElement("div",{className:"cheat-sheet-item__title"},"Filtering for search terms."),this.renderExpression('{app="cassandra"} |~ "(duration|latency)s*(=|is|of)s*[d.]+"'),this.renderExpression('{app="cassandra"} |= "exact match"'),this.renderExpression('{app="cassandra"} != "do not match"'),W.a.createElement("div",{className:"cheat-sheet-item__label"},W.a.createElement("a",{href:"https://github.com/grafana/loki/blob/master/docs/logql.md#filter-expression",target:"logql"},"LogQL")," ","supports exact and regular expression filters.")))},t}(K.PureComponent),J=r("KwPh"),$=r("uz0r"),H=function(e){var t=e.datasource,r=e.datasourceStatus,n=Object(a.g)(e,["datasource","datasourceStatus"]),s=Object($.a)(t.languageProvider,r,n.absoluteRange),o=s.isSyntaxReady,i=s.setActiveOption,c=s.refreshLabels,u=Object(a.g)(s,["isSyntaxReady","setActiveOption","refreshLabels"]);return W.a.createElement(J.a,Object(a.a)({datasource:t,datasourceStatus:r,syntaxLoaded:o,onLoadOptions:i,onLabelsRefresh:c},u,n))},Z=H,G=Object(K.memo)(function(e){var t,r=e.query,n=e.data,s=e.datasource,o=e.onChange,i=e.onRunQuery;if(n&&n.request){var c=n.request.range;t={from:c.from.valueOf(),to:c.to.valueOf()}}else t={from:Date.now()-1e4,to:Date.now()};var u=Object($.a)(s.languageProvider,O.DataSourceStatus.Connected,t),l=u.isSyntaxReady,p=u.setActiveOption,d=u.refreshLabels,f=Object(a.g)(u,["isSyntaxReady","setActiveOption","refreshLabels"]);return W.a.createElement("div",null,W.a.createElement(H,Object(a.a)({datasource:s,datasourceStatus:O.DataSourceStatus.Connected,query:r,onChange:o,onRunQuery:i,history:[],data:n,onLoadOptions:p,onLabelsRefresh:d,syntaxLoaded:l,absoluteRange:t},f)))}),X=function(){function e(){this.annotation.target=this.annotation.target||{},this.onQueryChange=this.onQueryChange.bind(this)}return e.prototype.onQueryChange=function(e){this.annotation.expr=e},e.templateUrl="partials/annotations.editor.html",e}();r.d(t,"LokiConfigCtrl",function(){return Y}),r.d(t,"ConfigCtrl",function(){return Y}),r.d(t,"Datasource",function(){return V}),r.d(t,"QueryEditor",function(){return G}),r.d(t,"ExploreQueryField",function(){return Z}),r.d(t,"ExploreStartPage",function(){return B}),r.d(t,"AnnotationsQueryCtrl",function(){return X});var Y=function(){function e(){}return e.templateUrl="partials/config.html",e}()},ceQ3:function(e,t,r){"use strict";r.d(t,"d",function(){return n}),r.d(t,"e",function(){return s}),r.d(t,"f",function(){return o}),r.d(t,"b",function(){return i}),r.d(t,"c",function(){return c}),r.d(t,"a",function(){return u});var a=r("mrSG"),n=function(e){for(var t=[],r=new RegExp("_bucket($|:)"),a=0;a<e.length;a++){var n=e[a];r.test(n)&&-1===t.indexOf(n)&&t.push(n)}return{values:{__name__:t}}};function s(e,t){void 0===t&&(t=!1);var r={};return e.forEach(function(e){var n=e.__name__,s=Object(a.g)(e,["__name__"]);t&&(r.__name__=r.__name__||[],r.__name__.includes(n)||r.__name__.push(n)),Object.keys(s).forEach(function(e){r[e]||(r[e]=[]),r[e].includes(s[e])||r[e].push(s[e])})}),{values:r,keys:Object.keys(r)}}var o=/\{[^}]*?\}/,i=/\b(\w+)(!?=~?)("[^"\n]*?")/g;function c(e,t){if(void 0===t&&(t=1),!e.match(o)){if(e.match(/^[A-Za-z:][\w:]*$/))return{selector:'{__name__="'+e+'"}',labelKeys:["__name__"]};throw new Error("Query must contain a selector: "+e)}var r=e.slice(0,t),a=r.lastIndexOf("{"),n=r.lastIndexOf("}");if(-1===a)throw new Error("Not inside selector, missing open brace: "+r);if(n>-1&&n>a)throw new Error("Not inside selector, previous selector already closed: "+r);var s=e.slice(t),c=s.indexOf("}")+t,u=s.indexOf("{"),l=u+t;if(-1===c)throw new Error("Not inside selector, missing closing brace in suffix: "+s);if(u>-1&&l<c)throw new Error("Not inside selector, next selector opens before this one closed: "+s);var p=e.slice(a,c),d={};p.replace(i,function(e,t,r,a){return d[t]={value:a,operator:r},""});var f=e.slice(0,a).match(/[A-Za-z:][\w:]*$/);f&&(d.__name__={value:'"'+f[0]+'"',operator:"="});var h=Object.keys(d).sort(),b=h.map(function(e){return""+e+d[e].operator+d[e].value}).join(",");return{labelKeys:h,selector:["{",b,"}"].join("")}}function u(e,t){var r=Object.keys(t),a=new RegExp("(\\s|^)("+r.join("|")+")(\\s|$|\\(|\\[|\\{)","ig");return e.replace(a,function(e,r,a,n){return""+r+t[a]+n})}},"eqT+":function(e,t,r){"use strict";r.d(t,"a",function(){return l});var a=r("LvDl"),n=r.n(a),s="by|without|on|ignoring|group_left|group_right|bool|or|and|unless",o=[s,"count|count_values|min|max|avg|sum|stddev|stdvar|bottomk|topk|quantile","true|false|null|__name__|job","abs|absent|ceil|changes|clamp_max|clamp_min|count_scalar|day_of_month|day_of_week|days_in_month|delta|deriv","drop_common_labels|exp|floor|histogram_quantile|holt_winters|hour|idelta|increase|irate|label_replace|ln|log2","log10|minute|month|predict_linear|rate|resets|round|scalar|sort|sort_desc|sqrt|time|vector|year|avg_over_time","min_over_time|max_over_time|sum_over_time|count_over_time|quantile_over_time|stddev_over_time|stdvar_over_time"].join("|").split("|"),i=/([A-Za-z:][\w:]*)\b(?![\(\]{=!",])/g,c=/{([^{]*)}/g;var u=/(\w+)\s*(=|!=|=~|!~)\s*("[^"]*")/g;function l(e,t,r,a){var s=[];if(e)for(var o=u.exec(e);o;)s.push({key:o[1],operator:o[2],value:o[3]}),o=u.exec(e);var i=a||"=";return s.push({key:t,operator:i,value:'"'+r+'"'}),"{"+n.a.chain(s).uniqWith(n.a.isEqual).compact().sortBy("key").map(function(e){return""+e.key+e.operator+e.value}).value().join(",")+"}"}t.b=function(e,t,r,a){if(!t||!r)throw new Error("Need label to add to query.");var n;e=e.replace(i,function(t,r,a){var i,c,u,l,p,d,f=(c=a,u="{",l="}",p=(i=e).slice(c).indexOf(u),(d=i.slice(c).indexOf(l))>-1&&(-1===p||p>d)),h=n&&s.split("|").indexOf(n)>-1,b=r.endsWith(":");return n=r,f||b||h||-1!==o.indexOf(r)?r:r+"{}"});for(var u=c.exec(e),p=[],d=0,f="";u;){var h=e.slice(d,u.index),b=l(u[1],t,r,a);d=u.index+u[1].length+2,f=e.slice(u.index+u[0].length),p.push(h,b),u=c.exec(e)}return p.push(f),p.join("")}}}]);
//# sourceMappingURL=lokiPlugin.18f32a9f431162a774b4.js.map