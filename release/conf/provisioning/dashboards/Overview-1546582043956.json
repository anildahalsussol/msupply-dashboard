{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": "-- Grafana --",
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "gnetId": null,
  "graphTooltip": 0,
  "id": 1,
  "iteration": 1546582037982,
  "links": [
    {
      "asDropdown": false,
      "icon": "external link",
      "tags": [
        "mSupply"
      ],
      "targetBlank": true,
      "title": "",
      "type": "dashboards"
    }
  ],
  "panels": [
    {
      "cacheTimeout": null,
      "colorBackground": false,
      "colorValue": false,
      "colors": [
        "#299c46",
        "rgba(237, 129, 40, 0.89)",
        "#d44a3a"
      ],
      "datasource": "PostgreSQL",
      "decimals": null,
      "format": "currencyUSD",
      "gauge": {
        "maxValue": 100,
        "minValue": 0,
        "show": false,
        "thresholdLabels": false,
        "thresholdMarkers": true
      },
      "gridPos": {
        "h": 2,
        "w": 5,
        "x": 0,
        "y": 0
      },
      "id": 18,
      "interval": null,
      "links": [],
      "mappingType": 1,
      "mappingTypes": [
        {
          "name": "value to text",
          "value": 1
        },
        {
          "name": "range to text",
          "value": 2
        }
      ],
      "maxDataPoints": 100,
      "nullPointMode": "connected",
      "nullText": null,
      "postfix": "",
      "postfixFontSize": "50%",
      "prefix": "USD",
      "prefixFontSize": "50%",
      "rangeMaps": [
        {
          "from": "null",
          "text": "N/A",
          "to": "null"
        }
      ],
      "repeat": null,
      "repeatDirection": "h",
      "sparkline": {
        "fillColor": "rgba(31, 118, 189, 0.18)",
        "full": false,
        "lineColor": "rgb(31, 120, 193)",
        "show": false
      },
      "tableColumn": "time",
      "targets": [
        {
          "format": "time_series",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "select current_date as time, sum(dv.value)\nfrom data_values dv\njoin data_value_elements dve on dv.uid = dve.data_value_uid\njoin data_elements store on dve.data_element_uid = store.uid and store.type = 'store'\nwhere dv.type='totalValue' and store.name in ([[store]]) group by 1;\n",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "thresholds": "",
      "title": "Total Stock Value",
      "type": "singlestat",
      "valueFontSize": "80%",
      "valueMaps": [
        {
          "op": "=",
          "text": "N/A",
          "value": "null"
        }
      ],
      "valueName": "avg"
    },
    {
      "aliasColors": {},
      "breakPoint": "50%",
      "cacheTimeout": null,
      "combine": {
        "label": "Others",
        "threshold": 0
      },
      "fontSize": "80%",
      "format": "currencyUSD",
      "gridPos": {
        "h": 11,
        "w": 5,
        "x": 5,
        "y": 0
      },
      "id": 12,
      "interval": null,
      "legend": {
        "percentage": false,
        "show": true,
        "sort": null,
        "sortDesc": null,
        "values": true
      },
      "legendType": "Under graph",
      "links": [],
      "maxDataPoints": 3,
      "nullPointMode": "connected",
      "pieType": "pie",
      "strokeWidth": 1,
      "targets": [
        {
          "format": "time_series",
          "group": [
            {
              "params": [
                "store"
              ],
              "type": "column"
            },
            {
              "params": [
                "date"
              ],
              "type": "column"
            }
          ],
          "hide": false,
          "metricColumn": "store",
          "rawQuery": true,
          "rawSql": "SELECT CURRENT_DATE AS \"time\",\n    store.name AS \"metric\",\n    sum(stock.value) \n   FROM data_values stock\n   join data_value_elements stock_join on stock.uid = stock_join.data_value_uid\n     JOIN data_elements store ON stock_join.data_element_uid::text = store.uid::text\n  WHERE stock.type::text = 'stockValue'::text AND store.name IN ($store)\n  group by 1, 2;",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              },
              {
                "params": [
                  "avg"
                ],
                "type": "aggregate"
              },
              {
                "params": [
                  "value"
                ],
                "type": "alias"
              }
            ]
          ],
          "table": "stock_status",
          "timeColumn": "date",
          "timeColumnType": "date",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            },
            {
              "datatype": "varchar",
              "name": "",
              "params": [
                "store",
                "IN",
                "($store)"
              ],
              "type": "expression"
            }
          ]
        }
      ],
      "title": "Stock Value by Store",
      "type": "grafana-piechart-panel",
      "valueName": "current"
    },
    {
      "circleMaxSize": 30,
      "circleMinSize": 2,
      "colors": [
        "rgba(245, 54, 54, 0.9)",
        "rgba(237, 129, 40, 0.89)",
        "#0a50a1",
        "rgba(50, 172, 45, 0.97)"
      ],
      "decimals": 0,
      "description": "Shows the average months of stock available across regions. The selection can be filtered by selecting one or more stores from the Store drop down at the top of the page.",
      "esMetric": "Count",
      "gridPos": {
        "h": 11,
        "w": 13,
        "x": 10,
        "y": 0
      },
      "hideEmpty": false,
      "hideZero": false,
      "id": 20,
      "initialZoom": "5",
      "links": [],
      "locationData": "table",
      "mapCenter": "custom",
      "mapCenterLatitude": "-41.2141504",
      "mapCenterLongitude": "173.9660801",
      "maxDataPoints": 1,
      "mouseWheelZoom": false,
      "showLegend": true,
      "stickyLabels": false,
      "tableQueryOptions": {
        "geohashField": "geojson",
        "geojsonField": "geojson",
        "labelField": "region",
        "latitudeField": "latitude",
        "longitudeField": "longitude",
        "metricField": "value",
        "queryType": "geojson"
      },
      "targets": [
        {
          "format": "table",
          "group": [
            {
              "params": [
                "$__interval",
                "none"
              ],
              "type": "time"
            }
          ],
          "hide": false,
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT\n  \"time\",\n  region,\n  geojson,\n  avg(value) AS \"value\"\nFROM region_mos\nwhere store in ([[store]])\nGROUP BY 1,2,3\nORDER BY 1",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              },
              {
                "params": [
                  "sum"
                ],
                "type": "aggregate"
              },
              {
                "params": [
                  "value"
                ],
                "type": "alias"
              }
            ]
          ],
          "table": "region_mos",
          "timeColumn": "value",
          "timeColumnType": "float8",
          "where": [
            {
              "name": "$__unixEpochFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "thresholds": "0,6,12",
      "title": "Months of Stock by Region",
      "type": "grafana-region-map-panel",
      "unitPlural": "",
      "unitSingle": "",
      "valueName": "total"
    },
    {
      "aliasColors": {
        "normal": "#7ED321",
        "over (>2)": "#22C7FC",
        "under (<1)": "#F5A623",
        "zero": "#D80206"
      },
      "breakPoint": "50%",
      "cacheTimeout": null,
      "combine": {
        "label": "Others",
        "threshold": 0
      },
      "decimals": null,
      "description": "Shows average months of stock available for the store(s) and item(s) that you select above.\nUnder is less than three months, Over is more than six and Normal is between three and six months.",
      "fontSize": "80%",
      "format": "short",
      "gridPos": {
        "h": 9,
        "w": 5,
        "x": 0,
        "y": 2
      },
      "id": 16,
      "interval": null,
      "legend": {
        "header": "",
        "percentage": false,
        "show": true,
        "values": true
      },
      "legendType": "Under graph",
      "links": [],
      "maxDataPoints": 3,
      "nullPointMode": "connected",
      "pieType": "donut",
      "strokeWidth": 1,
      "targets": [
        {
          "format": "time_series",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "select CURRENT_DATE AS \"time\", case when value = 0 then 'zero' when value > 6 then 'over (>6)' when value < 3 then 'under (<3)' else 'normal' end as metric, count(*) as count \nfrom\n(\nselect avg(value) as value\nfrom\n(\n   SELECT item.name AS item,\n    mos.value\n   FROM data_values mos\n   join data_value_elements store_join on mos.uid = store_join.data_value_uid \n     JOIN data_elements store ON store_join.data_element_uid = store.uid and store.type = 'store'\n   join data_value_elements item_join on mos.uid = item_join.data_value_uid \n     JOIN data_elements item ON item_join.data_element_uid::text = item.uid::text and item.type = 'item'\n  WHERE mos.type = 'MOS'\n  AND store.name IN ($store)\n  GROUP BY store.name, item.name, value\n) as a\n  WHERE item = $item\ngroup by item\n) as b\ngroup by 2;",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Stock Status",
      "transparent": true,
      "type": "grafana-piechart-panel",
      "valueName": "current"
    },
    {
      "columns": [],
      "datasource": "PostgreSQL",
      "fontSize": "100%",
      "gridPos": {
        "h": 11,
        "w": 10,
        "x": 0,
        "y": 11
      },
      "id": 4,
      "links": [],
      "pageSize": null,
      "scroll": true,
      "showHeader": true,
      "sort": {
        "col": 0,
        "desc": false
      },
      "styles": [
        {
          "alias": "Time",
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "pattern": "Time",
          "type": "date"
        },
        {
          "alias": "",
          "colorMode": null,
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "decimals": 0,
          "mappingType": 1,
          "pattern": "Week",
          "thresholds": [],
          "type": "number",
          "unit": "short"
        },
        {
          "alias": "",
          "colorMode": null,
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "decimals": 0,
          "mappingType": 1,
          "pattern": "Month",
          "thresholds": [],
          "type": "number",
          "unit": "short"
        },
        {
          "alias": "",
          "colorMode": null,
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "decimals": 2,
          "pattern": "/.*/",
          "thresholds": [],
          "type": "number",
          "unit": "short"
        }
      ],
      "targets": [
        {
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "select \"Store\", \"Week\", \"Month\" from store_transactions\nwhere \"Store\" in ([[store]])\n\n\n",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Transactions per Store",
      "transform": "table",
      "type": "table"
    },
    {
      "aliasColors": {},
      "bars": false,
      "dashLength": 10,
      "dashes": false,
      "fill": 1,
      "gridPos": {
        "h": 11,
        "w": 13,
        "x": 10,
        "y": 11
      },
      "id": 2,
      "legend": {
        "avg": false,
        "current": false,
        "max": false,
        "min": false,
        "show": true,
        "total": false,
        "values": false
      },
      "lines": true,
      "linewidth": 1,
      "links": [],
      "nullPointMode": "null",
      "percentage": false,
      "pointradius": 5,
      "points": false,
      "renderer": "flot",
      "seriesOverrides": [],
      "spaceLength": 10,
      "stack": false,
      "steppedLine": false,
      "targets": [
        {
          "format": "time_series",
          "group": [],
          "metricColumn": "name",
          "rawQuery": true,
          "rawSql": "SELECT date as \"time\", store.name as metric, sum(value)\n          FROM data_values stock\n             JOIN data_value_elements store_join ON stock.uid::text = store_join.data_value_uid\n                          join data_elements store on store_join.data_element_uid = store.uid\n          WHERE stock.type='stockHistory' and store.type = 'store'\n  and $__timeFilter(\"date\")\n  and store.name in ([[store]])\n  group by 1, 2\n  order by 1, 2\n  ",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "id"
                ],
                "type": "column"
              }
            ]
          ],
          "table": "data_values",
          "timeColumn": "date",
          "timeColumnType": "date",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "thresholds": [],
      "timeFrom": null,
      "timeRegions": [],
      "timeShift": null,
      "title": "Stock History over time by Store",
      "tooltip": {
        "shared": true,
        "sort": 0,
        "value_type": "individual"
      },
      "type": "graph",
      "xaxis": {
        "buckets": null,
        "mode": "time",
        "name": null,
        "show": true,
        "values": []
      },
      "yaxes": [
        {
          "format": "short",
          "label": null,
          "logBase": 1,
          "max": null,
          "min": null,
          "show": true
        },
        {
          "format": "short",
          "label": null,
          "logBase": 1,
          "max": null,
          "min": null,
          "show": true
        }
      ],
      "yaxis": {
        "align": false,
        "alignLevel": null
      }
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 22
      },
      "id": 6,
      "panels": [],
      "title": "Stock and transactions (click to show/hide)",
      "type": "row"
    }
  ],
  "schemaVersion": 16,
  "style": "dark",
  "tags": [
    "mSupply"
  ],
  "templating": {
    "list": [
      {
        "allValue": null,
        "current": {
          "text": "All",
          "value": [
            "$__all"
          ]
        },
        "datasource": "PostgreSQL",
        "definition": "select de.name from data_elements de join user_elements ue on de.uid = ue.element_uid where de.type = 'store'  order by de.name",
        "hide": 0,
        "includeAll": true,
        "label": "Store",
        "multi": true,
        "name": "store",
        "options": [],
        "query": "select de.name from data_elements de join user_elements ue on de.uid = ue.element_uid where de.type = 'store'  order by de.name",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "tagValuesQuery": "",
        "tags": [],
        "tagsQuery": "",
        "type": "query",
        "useTags": false
      },
      {
        "allValue": "item",
        "current": {
          "text": "All",
          "value": "$__all"
        },
        "datasource": "PostgreSQL",
        "definition": "select de.name from data_elements de where de.type = 'item' order by de.name",
        "hide": 0,
        "includeAll": true,
        "label": "Item",
        "multi": false,
        "name": "item",
        "options": [],
        "query": "select de.name from data_elements de where de.type = 'item' order by de.name",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "tagValuesQuery": "",
        "tags": [],
        "tagsQuery": "",
        "type": "query",
        "useTags": false
      },
      {
        "allValue": null,
        "current": {
          "text": "All",
          "value": "$__all"
        },
        "datasource": "-- Grafana --",
        "definition": "select 'Auckland' from data_elements limit 1",
        "hide": 0,
        "includeAll": true,
        "label": "Region",
        "multi": false,
        "name": "region",
        "options": [],
        "query": "",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "tagValuesQuery": "",
        "tags": [],
        "tagsQuery": "",
        "type": "query",
        "useTags": false
      }
    ]
  },
  "time": {
    "from": "now/y",
    "to": "now/y"
  },
  "timepicker": {
    "hidden": false,
    "refresh_intervals": [
      "5s",
      "10s",
      "30s",
      "1m",
      "5m",
      "15m",
      "30m",
      "1h",
      "2h",
      "1d"
    ],
    "time_options": [
      "5m",
      "15m",
      "1h",
      "6h",
      "12h",
      "24h",
      "2d",
      "7d",
      "30d"
    ]
  },
  "timezone": "browser",
  "title": "Overview",
  "uid": "jquMpWPik",
  "version": 23
}